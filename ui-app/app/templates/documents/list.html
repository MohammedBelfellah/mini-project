{% extends "base.html" %} {% block title %}Documents - {{ building_name }}{%
endblock %} {% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h1>
    <i class="bi bi-file-earmark-image"></i> Documents de {{ building_name }}
  </h1>
  <div>
    <a
      href="{{ url_for('documents.add_document', building_id=building_id) }}"
      class="btn btn-primary"
    >
      <i class="bi bi-plus-circle"></i> Ajouter un Document
    </a>
    <a
      href="{{ url_for('buildings.view_building', id=building_id) }}"
      class="btn btn-secondary"
    >
      <i class="bi bi-arrow-left"></i> Retour au Bâtiment
    </a>
  </div>
</div>

<!-- Results -->
<div class="d-flex justify-content-between align-items-center mb-3">
  <span class="text-muted">
    <i class="bi bi-file-earmark"></i> {{ documents|length }} document(s)
  </span>
</div>

{% if documents %}
<div class="row">
  {% for doc in documents %}
  <div class="col-md-4 col-lg-3 mb-4">
    <div class="card h-100">
      <div class="card-body text-center">
        {% if doc[2] == 'Photo' %}
        <i class="bi bi-image text-success" style="font-size: 4rem"></i>
        {% elif doc[2] == 'Plan' %}
        <i class="bi bi-map text-primary" style="font-size: 4rem"></i>
        {% elif doc[2] == 'PDF' %}
        <i class="bi bi-file-pdf text-danger" style="font-size: 4rem"></i>
        {% elif doc[2] == 'Vidéo' %}
        <i class="bi bi-camera-video text-warning" style="font-size: 4rem"></i>
        {% else %}
        <i
          class="bi bi-file-earmark text-secondary"
          style="font-size: 4rem"
        ></i>
        {% endif %}

        <h6 class="card-title mt-3">{{ doc[1] }}</h6>
        <span class="badge bg-info">{{ doc[2] }}</span>
      </div>
      <div class="card-footer bg-transparent">
        <div class="btn-group btn-group-sm w-100">
          <a
            href="{{ url_for('documents.view_document', id=doc[0]) }}"
            class="btn btn-outline-primary"
            title="Voir"
          >
            <i class="bi bi-eye"></i>
          </a>
          <a
            href="{{ url_for('documents.edit_document', id=doc[0]) }}"
            class="btn btn-outline-warning"
            title="Modifier"
          >
            <i class="bi bi-pencil"></i>
          </a>
          <button
            type="button"
            class="btn btn-outline-danger"
            title="Supprimer"
            data-doc-id="{{ doc[0] }}"
            data-doc-name="{{ doc[1]|e }}"
            onclick="confirmDelete(this.dataset.docId, this.dataset.docName)"
          >
            <i class="bi bi-trash"></i>
          </button>
        </div>
      </div>
    </div>
  </div>
  {% endfor %}
</div>
{% else %}
<div class="card">
  <div class="card-body text-center py-5">
    <i class="bi bi-inbox text-muted" style="font-size: 4rem"></i>
    <p class="text-muted mt-3 mb-0">
      Aucun document enregistré pour ce bâtiment.
    </p>
    <a
      href="{{ url_for('documents.add_document', building_id=building_id) }}"
      class="btn btn-primary mt-3"
    >
      <i class="bi bi-plus-circle"></i> Ajouter le premier document
    </a>
  </div>
</div>
{% endif %}

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title">
          <i class="bi bi-exclamation-triangle"></i> Confirmer la suppression
        </h5>
        <button
          type="button"
          class="btn-close btn-close-white"
          data-bs-dismiss="modal"
        ></button>
      </div>
      <div class="modal-body">
        <p>
          Êtes-vous sûr de vouloir supprimer le document
          <strong id="docName"></strong>?
        </p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          Annuler
        </button>
        <form id="deleteForm" method="POST" style="display: inline">
          <button type="submit" class="btn btn-danger">
            <i class="bi bi-trash"></i> Supprimer
          </button>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block extra_js %}
<script>
  function confirmDelete(id, name) {
    document.getElementById("docName").textContent = name;
    document.getElementById("deleteForm").action = `/documents/delete/${id}`;
    new bootstrap.Modal(document.getElementById("deleteModal")).show();
  }
</script>
{% endblock %}
